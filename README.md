

Этот код состоит из сценария на языке Python (`predict_online.py`), который загружает обученные модели LSTM и скейлеры, собирает данные из базы данных Clickhouse, применяет техники предварительной обработки данных, такие как скользящее среднее, экспоненциальное и двойное экспоненциальное сглаживание, подготавливает данные для каждой модели LSTM и генерирует прогнозы с использованием каждой модели. Затем он вычисляет значения потерь между предсказанными и истинными значениями для каждой модели и сохраняет их в другую таблицу базы данных Clickhouse.

Чтобы запустить скрипт, выполните следующие шаги:

1. Установите необходимые пакеты: `numpy`,` pandas`, `tensorflow`,` joblib`, `clickhouse_driver`
``` bash
pip install -r requirements.txt
```

2. Измените файл конфигурации `config_online.yaml`, чтобы установить желаемые значения для следующих параметров:
     - `KKS`: Подгружается из базы данных, возможен запуск через csv при передаче аргумента при запуске скрипта `--csv_kks True`' путь к CSV-файлу, содержащему коды KKS внешних тегов, которые будут использоваться для каждой модели LSTM.
     - `WEIGHTS`: путь к папке с обученными моделями LSTM.
     - `SCALER`: путь к папке с соответствующими масштабировщиками каждой модели LSTM.
     - `NUM_GROUPS`: количество моделей LSTM, которые будут использоваться.
     - `LAG`: временная задержка, которая должна быть учтена для каждой модели LSTM.
     - `QUERY_DF`: запрос для извлечения данных из базы данных Clickhouse.
     - `CREATE_TABLE`: При значении `True` создает таблицу для записи отчетов.
     - `ROLLING_MEAN`: логическое значение, указывающее, применять ли скользящее среднее к данным или нет.
     - `EXP_SMOOTH`: логическое значение, указывающее, применять ли экспоненциальное сглаживание к данным или нет.
     - `DOUBLE_EXP_SMOOTH`: логическое значение, указывающее, применять ли двойное экспоненциальное сглаживание к данным или нет.
     - `ROLLING_MEAN_WINDOW`: размер окна, используемого для скользящего среднего.
     - `POWER_ID`: Идентификатор датчика мощности.
     - `POWER_LIMIT`: Заданный лимит отслеживания мощности, при котором система пересчитывает значения аномальности.
     - `TRAIN_LEN_FORECAST`: Длина выборки для обучения предсказательного алгоритма.
     - `LEN_FORECAST`: Длина предсказанной последовательности.
     - `WINDOW_SIZE`: Параметр шага предсказанной последовательнсти(параметр для настройки предсказательного алгоритма).
     - `TRESHOLD_ANOMALY`: Порог значения для определения аномальности.
     - `CONTINUE_COUNT`: Значение длителности аномального участка.


3. Запустите следующую команду для выполнения сценария:

``` bash
python predict_online.py --config_path /path/to/config/
```

Примечание: замените `/path/to/config/` на фактический путь к папке с файлом `config_online.yaml`.

Скрипт будет работать непрерывно, запрашивая данные из базы данных Clickhouse каждые 5 секунд, пока его не остановят вручную. Значения потерь между предсказанными и истинными значениями для каждой модели LSTM будут сохранены в таблицах с именами `lstm_groupX`, где `X` представляет номер группы соответствующей модели LSTM. Результаты могут быть получены запросом к базе данных Clickhouse.